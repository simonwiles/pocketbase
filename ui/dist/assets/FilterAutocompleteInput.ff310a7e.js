import{S as re,i as oe,s as ae,e as ue,f as le,g as ce,y as O,o as fe,I as de,J as he,K as ge,L as pe,C as E,M as ye}from"./index.8d10a2b6.js";import{C as I,E as q,a as S,h as me,b as be,c as ke,d as xe,e as Ke,s as Ce,f as qe,g as Se,i as we,r as Le,j as Ee,k as Ie,l as Re,m as Ae,n as ve,o as Be,p as _e,q as Me,t as X,S as Oe}from"./index.e8a8986f.js";function De(e){Y(e,"start");var i={},n=e.languageData||{},g=!1;for(var p in e)if(p!=n&&e.hasOwnProperty(p))for(var d=i[p]=[],o=e[p],r=0;r<o.length;r++){var l=o[r];d.push(new Te(l,e)),(l.indent||l.dedent)&&(g=!0)}return{name:n.name,startState:function(){return{state:"start",pending:null,indent:g?[]:null}},copyState:function(a){var m={state:a.state,pending:a.pending,indent:a.indent&&a.indent.slice(0)};return a.stack&&(m.stack=a.stack.slice(0)),m},token:Ue(i),indent:We(i,n),languageData:n}}function Y(e,i){if(!e.hasOwnProperty(i))throw new Error("Undefined state "+i+" in simple mode")}function He(e,i){if(!e)return/(?:)/;var n="";return e instanceof RegExp?(e.ignoreCase&&(n="i"),e=e.source):e=String(e),new RegExp((i===!1?"":"^")+"(?:"+e+")",n)}function Fe(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var i=[],n=0;n<e.length;n++)i.push(e[n]&&e[n].replace(/\./g," "));return i}function Te(e,i){(e.next||e.push)&&Y(i,e.next||e.push),this.regex=He(e.regex),this.token=Fe(e.token),this.data=e}function Ue(e){return function(i,n){if(n.pending){var g=n.pending.shift();return n.pending.length==0&&(n.pending=null),i.pos+=g.text.length,g.token}for(var p=e[n.state],d=0;d<p.length;d++){var o=p[d],r=(!o.data.sol||i.sol())&&i.match(o.regex);if(r){o.data.next?n.state=o.data.next:o.data.push?((n.stack||(n.stack=[])).push(n.state),n.state=o.data.push):o.data.pop&&n.stack&&n.stack.length&&(n.state=n.stack.pop()),o.data.indent&&n.indent.push(i.indentation()+i.indentUnit),o.data.dedent&&n.indent.pop();var l=o.token;if(l&&l.apply&&(l=l(r)),r.length>2&&o.token&&typeof o.token!="string"){n.pending=[];for(var a=2;a<r.length;a++)r[a]&&n.pending.push({text:r[a],token:o.token[a-1]});return i.backUp(r[0].length-(r[1]?r[1].length:0)),l[0]}else return l&&l.join?l[0]:l}}return i.next(),null}}function We(e,i){return function(n,g){if(n.indent==null||i.dontIndentStates&&i.doneIndentState.indexOf(n.state)>-1)return null;var p=n.indent.length-1,d=e[n.state];e:for(;;){for(var o=0;o<d.length;o++){var r=d[o];if(r.data.dedent&&r.data.dedentIfLineStart!==!1){var l=r.regex.exec(g);if(l&&l[0]){p--,(r.next||r.push)&&(d=e[r.next||r.push]),g=g.slice(l[0].length);continue e}}}break}return p<0?0:n.indent[p]}}function Ne(e){let i;return{c(){i=ue("div"),le(i,"class","code-editor")},m(n,g){ce(n,i,g),e[15](i)},p:O,i:O,o:O,d(n){n&&fe(i),e[15](null)}}}function Ve(e){return JSON.stringify([e==null?void 0:e.name,e==null?void 0:e.type,e==null?void 0:e.schema])}function Je(e,i,n){let g;de(e,he,t=>n(21,g=t));const p=ge();let{id:d=""}=i,{value:o=""}=i,{disabled:r=!1}=i,{placeholder:l=""}=i,{baseCollection:a=null}=i,{singleLine:m=!1}=i,{extraAutocompleteKeys:R=[]}=i,{disableRequestKeys:x=!1}=i,{disableIndirectCollectionsKeys:K=!1}=i,f,b,A=r,D=new I,H=new I,F=new I,T=new I,w=[],U=[],W=[],N=[],L="",v="";function B(){f==null||f.focus()}let _=null;function Z(){clearTimeout(_),_=setTimeout(()=>{w=j(g),N=$(),U=x?[]:ee(),W=K?[]:te()},300)}function j(t){let s=t.slice();return a&&E.pushOrReplaceByKey(s,a,"id"),s}function V(){b==null||b.dispatchEvent(new CustomEvent("change",{detail:{value:o},bubbles:!0}))}function J(){if(!d)return;const t=document.querySelectorAll('[for="'+d+'"]');for(let s of t)s.removeEventListener("click",B)}function P(){if(!d)return;J();const t=document.querySelectorAll('[for="'+d+'"]');for(let s of t)s.addEventListener("click",B)}function C(t,s="",c=0){var k,z;let h=w.find(y=>y.name==t||y.id==t);if(!h||c>=4)return[];let u=[s+"id",s+"created",s+"updated"];h.isAuth&&(u.push(s+"username"),u.push(s+"email"),u.push(s+"emailVisibility"),u.push(s+"verified"));for(const y of h.schema){const M=s+y.name;if(u.push(M),y.type==="relation"&&((k=y.options)==null?void 0:k.collectionId)){const Q=C(y.options.collectionId,M+".",c+1);Q.length&&(u=u.concat(Q))}y.type==="select"&&((z=y.options)==null?void 0:z.maxSelect)!=1&&u.push(M+".each")}return u}function $(){return C(a==null?void 0:a.name)}function ee(){const t=[];t.push("@request.method"),t.push("@request.query."),t.push("@request.data."),t.push("@request.auth.id"),t.push("@request.auth.collectionId"),t.push("@request.auth.collectionName"),t.push("@request.auth.verified"),t.push("@request.auth.username"),t.push("@request.auth.email"),t.push("@request.auth.emailVisibility"),t.push("@request.auth.created"),t.push("@request.auth.updated");const s=w.filter(h=>h.isAuth);for(const h of s){const u=C(h.id,"@request.auth.");for(const k of u)E.pushUnique(t,k)}const c=["created","updated"];if(a!=null&&a.id){const h=C(a.name,"@request.data.");for(const u of h){t.push(u);const k=u.split(".");k.length===3&&!c.includes(k[2])&&t.push(u+".isset")}}return t}function te(){const t=[];for(const s of w){const c="@collection."+s.name+".",h=C(s.name,c);for(const u of h)t.push(u)}return t}function ne(t=!0,s=!0){let c=[].concat(R);return c=c.concat(N||[]),t&&(c=c.concat(U||[])),s&&(c=c.concat(W||[])),c.sort(function(h,u){return u.length-h.length}),c}function ie(t){let s=t.matchBefore(/[\'\"\@\w\.]*/);if(s&&s.from==s.to&&!t.explicit)return null;let c=[{label:"false"},{label:"true"},{label:"@now"}];K||c.push({label:"@collection.*",apply:"@collection."});const h=ne(!x,!x&&s.text.startsWith("@c"));for(const u of h)c.push({label:u.endsWith(".")?u+"*":u,apply:u});return{from:s.from,options:c}}function G(){return Oe.define(De({start:[{regex:/true|false|null/,token:"atom"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:E.escapeRegExp("@now"),token:"keyword"},{regex:E.escapeRegExp("@request.method"),token:"keyword"}]}))}pe(()=>{const t={key:"Enter",run:s=>{m&&p("submit",o)}};return P(),n(11,f=new q({parent:b,state:S.create({doc:o,extensions:[me(),be(),ke(),xe(),Ke(),S.allowMultipleSelections.of(!0),Ce(qe,{fallback:!0}),Se(),we(),Le(),Ee(),Ie.of([t,...Re,...Ae,ve.find(s=>s.key==="Mod-d"),...Be,..._e]),q.lineWrapping,Me({override:[ie],icons:!1}),T.of(X(l)),H.of(q.editable.of(!r)),F.of(S.readOnly.of(r)),D.of(G()),S.transactionFilter.of(s=>m&&s.newDoc.lines>1?[]:s),q.updateListener.of(s=>{!s.docChanged||r||(n(1,o=s.state.doc.toString()),V())})]})})),()=>{clearTimeout(_),J(),f==null||f.destroy()}});function se(t){ye[t?"unshift":"push"](()=>{b=t,n(0,b)})}return e.$$set=t=>{"id"in t&&n(2,d=t.id),"value"in t&&n(1,o=t.value),"disabled"in t&&n(3,r=t.disabled),"placeholder"in t&&n(4,l=t.placeholder),"baseCollection"in t&&n(5,a=t.baseCollection),"singleLine"in t&&n(6,m=t.singleLine),"extraAutocompleteKeys"in t&&n(7,R=t.extraAutocompleteKeys),"disableRequestKeys"in t&&n(8,x=t.disableRequestKeys),"disableIndirectCollectionsKeys"in t&&n(9,K=t.disableIndirectCollectionsKeys)},e.$$.update=()=>{e.$$.dirty[0]&32&&n(13,L=Ve(a)),e.$$.dirty[0]&25352&&!r&&(v!=L||x!==-1||K!==-1)&&(n(14,v=L),Z()),e.$$.dirty[0]&4&&d&&P(),e.$$.dirty[0]&2080&&f&&(a==null?void 0:a.schema)&&f.dispatch({effects:[D.reconfigure(G())]}),e.$$.dirty[0]&6152&&f&&A!=r&&(f.dispatch({effects:[H.reconfigure(q.editable.of(!r)),F.reconfigure(S.readOnly.of(r))]}),n(12,A=r),V()),e.$$.dirty[0]&2050&&f&&o!=f.state.doc.toString()&&f.dispatch({changes:{from:0,to:f.state.doc.length,insert:o}}),e.$$.dirty[0]&2064&&f&&typeof l<"u"&&f.dispatch({effects:[T.reconfigure(X(l))]})},[b,o,d,r,l,a,m,R,x,K,B,f,A,L,v,se]}class ze extends re{constructor(i){super(),oe(this,i,Je,Ne,ae,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableIndirectCollectionsKeys:9,focus:10},null,[-1,-1])}get focus(){return this.$$.ctx[10]}}export{ze as default};
